


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > ExpenseUCI</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">use_cases.add_edit_expenses_use_case</a>
</div>

<h1>Coverage Summary for Class: ExpenseUCI (use_cases.add_edit_expenses_use_case)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">ExpenseUCI</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (8/8)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    70.8%
  </span>
  <span class="absValue">
    (80/113)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package use_cases.add_edit_expenses_use_case;
&nbsp;
&nbsp;import entities.*;
&nbsp;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.NoSuchElementException;
&nbsp;import java.util.Objects;
&nbsp;
&nbsp;public class ExpenseUCI implements ExpenseInputBoundary {
&nbsp;    private final ExpenseOB expenseOB;
&nbsp;    private ExpenseID expenseInputData;
&nbsp;    private ArrayList&lt;Expense&gt; recurringExpenseList;
&nbsp;    private ArrayList&lt;Expense&gt; monthExpenseList;
&nbsp;
&nbsp;
&nbsp;    /**
&nbsp;     * Constructs ExpenseUCI.
&nbsp;     *
&nbsp;     * @param expenseP presenter that is related to the use case.
&nbsp;     */
<b class="fc">&nbsp;    public ExpenseUCI(ExpenseOB expenseP) {</b>
<b class="fc">&nbsp;        this.expenseOB = expenseP;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Helper method returns a double to check if the input Object is a valid double.
&nbsp;     *
&nbsp;     * @param value a user input
&nbsp;     * @return double converted from value
&nbsp;     */
&nbsp;    public static double toDouble(Object value) throws NumberFormatException, NullPointerException {
<b class="fc">&nbsp;        return Double.parseDouble(String.valueOf(value));</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Overrides method in ExpenseInputBoundary.
&nbsp;     * Attempts to add an expense with information from ExpenseID and returns a ExpenseOD indicating whether fail/success after execution.
&nbsp;     * Provides detailed fail messages according to each condition listed below:
&nbsp;     * 1. NumberFormatException: User tries to add a new budget value that can not be converted to a double.
&nbsp;     * 2. Expense budget less than 0: User tries to add a new budget value that is a negative number.
&nbsp;     * 3. EntityException: User tries to add an invalid Expense name but failed. (See entities/EntityException.java)
&nbsp;     * 4. Same recurring expense name: User tries to add an expense name that is a saved recurring expense in the current SessionStorage.
&nbsp;     *
&nbsp;     * @param expenseInputDataAdd ExpenseID required for adding a new expense to the designated monthID MonthlyStorage Object.
&nbsp;     * @return ExpenseOD String message indicating success/fail add attempt.
&nbsp;     * @throws EntityException thrown when expenseInputDataAdd has invalid expense information.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public ExpenseOD addExpenseInMonth(ExpenseID expenseInputDataAdd) throws EntityException {
<b class="fc">&nbsp;        this.expenseInputData = expenseInputDataAdd;</b>
<b class="fc">&nbsp;        SessionStorage session = expenseInputDataAdd.getSession();</b>
<b class="fc">&nbsp;        MonthlyStorage month = expenseInputDataAdd.getSession().getMonthlyData(expenseInputDataAdd.getMonthID());</b>
<b class="fc">&nbsp;        ArrayList&lt;Expense&gt; monthExpenseList = month.getExpenseData();</b>
<b class="fc">&nbsp;        ArrayList&lt;Category&gt; categoryList = month.getCategoryData();</b>
<b class="fc">&nbsp;        this.recurringExpenseList = session.getRecurData();</b>
&nbsp;
&nbsp;        try {
<b class="fc">&nbsp;            double valueDouble = toDouble(expenseInputDataAdd.getValue());</b>
&nbsp;
<b class="fc">&nbsp;            Category selectedCategory = findCategory(categoryList, expenseInputData.getOldCategory());</b>
<b class="fc">&nbsp;            Category other = findCategory(categoryList, &quot;Other&quot;);</b>
&nbsp;
<b class="fc">&nbsp;            if (valueDouble &lt; 0) {</b>
&nbsp;                // 2. Expense budget less than 0 fail
<b class="fc">&nbsp;                ExpenseOD expenseOutputDataFailAdd = new ExpenseOD(&quot;Expense value can&#39;t be less than $0. Please try again!&quot;);</b>
<b class="fc">&nbsp;                return expenseOB.fail(expenseOutputDataFailAdd);</b>
&nbsp;            }
<b class="fc">&nbsp;            for (Expense expense1 : monthExpenseList) {</b>
<b class="fc">&nbsp;                if (expense1.getName().equals(expenseInputData.getName())) {</b>
&nbsp;                    //Repeated name in month
<b class="fc">&nbsp;                    ExpenseOD expenseOutputDataFailEdit = new ExpenseOD(&quot;There is already a expense with this new name in this month.&quot;);</b>
<b class="fc">&nbsp;                    return expenseOB.fail(expenseOutputDataFailEdit);</b>
&nbsp;                }
<b class="fc">&nbsp;            }</b>
&nbsp;
<b class="fc">&nbsp;            if (expenseInputData.getIsRecurringExpense()) {</b>
<b class="fc">&nbsp;                if(recurringExpenseList.size() &gt; 0) {</b>
<b class="fc">&nbsp;                    for (Expense expense1 : recurringExpenseList) {</b>
<b class="fc">&nbsp;                        if (expense1.getName().equals(expenseInputData.getName())) {</b>
&nbsp;                            //Repeated name in recurringData
<b class="fc">&nbsp;                            ExpenseOD expenseOutputDataFailAdd = new ExpenseOD(&quot;There is a recurring expense with this name, you don&#39;t need to add expense in month. &quot; +</b>
&nbsp;                                    &quot;(If this is not the same expense, please use another name!)&quot;);
<b class="fc">&nbsp;                            return expenseOB.fail(expenseOutputDataFailAdd);</b>
&nbsp;                        }
<b class="nc">&nbsp;                    }</b>
&nbsp;                }else{
<b class="fc">&nbsp;                    Expense newrecurExpense = new Expense(expenseInputData.getName(), other, valueDouble);</b>
<b class="fc">&nbsp;                    session.addRecurExpense(newrecurExpense);</b>
<b class="fc">&nbsp;                    ExpenseOD expenseOutputDataSuccessAdd = new ExpenseOD(&quot;You have created a new recurring expense!&quot;);</b>
<b class="fc">&nbsp;                    return expenseOB.success(expenseOutputDataSuccessAdd);}</b>
&nbsp;                    }
&nbsp;
<b class="fc">&nbsp;            Expense newExpense = new Expense(expenseInputData.getName(), selectedCategory,valueDouble);</b>
&nbsp;
<b class="fc">&nbsp;            month.addExpense(newExpense);</b>
<b class="fc">&nbsp;            ExpenseOD expenseOutputDataSuccessAdd = new ExpenseOD(&quot;You have added a new expense!&quot;);</b>
<b class="fc">&nbsp;            return expenseOB.success(expenseOutputDataSuccessAdd);</b>
&nbsp;
<b class="fc">&nbsp;        } catch (NumberFormatException | NullPointerException e) {</b>
&nbsp;            //1. NumberFormatException/NullPointerException fail
<b class="fc">&nbsp;            ExpenseOD expenseOutputDataFailAdd = new ExpenseOD(&quot;Expense value is needs to be a number. Please try again!&quot;);</b>
<b class="fc">&nbsp;            return expenseOB.fail(expenseOutputDataFailAdd);</b>
&nbsp;
<b class="nc">&nbsp;        } catch (EntityException e) {</b>
&nbsp;            //3. EntityException fail
<b class="nc">&nbsp;            ExpenseOD expenseOutputDataFailAdd = new ExpenseOD(&quot;There is already a expense with this new name in this month.&quot;);</b>
<b class="nc">&nbsp;            return expenseOB.fail(expenseOutputDataFailAdd);</b>
<b class="nc">&nbsp;        } catch(NoSuchElementException e){</b>
&nbsp;        //2. NoSuchElementException fail
<b class="nc">&nbsp;        ExpenseOD expenseOutputDataFailEdit = new ExpenseOD(&quot;There is no such expense in the current month. Please add a new expense or select existing expense!&quot;);</b>
<b class="nc">&nbsp;        return expenseOB.fail(expenseOutputDataFailEdit);</b>
&nbsp;    }}
&nbsp;
&nbsp;    /**
&nbsp;     * Attempts to edit an expense with information from ExpenseID and returns a ExpenseOD indicating whether fail/success after execution.
&nbsp;     * Provides detailed fail messages according to each condition listed below:
&nbsp;     * 1. Repeated Name: User tries to edit expense name to another name that exists in the month.
&nbsp;     * 2. NoSuchElementException: User tries to edit an expense that does not exist.
&nbsp;     * 3. NumberFormatException|NullPointerException: User tries to edit a budget value with input that can not be converted to a double.
&nbsp;     * 4. Expense budget less than 0: User tries to edit a budget value with input that is a negative number.
&nbsp;     *
&nbsp;     * @param expenseInputDataEdit ExpenseID required for editing a new expense to the designated monthID MonthlyStorage Object.
&nbsp;     * @return ExpenseOD String message indicating success/fail add attempt.
&nbsp;     * @throws EntityException (Although we know MonthlyStorage with monthID is always in the SessionStorage,
&nbsp;     *                         it will be caught at views/add_edit_expense_views/EditExpenseV.java).
&nbsp;     */
&nbsp;    @Override
&nbsp;    public ExpenseOD editExpenseInMonth(ExpenseID expenseInputDataEdit) throws EntityException {
<b class="fc">&nbsp;        this.expenseInputData = expenseInputDataEdit;</b>
<b class="fc">&nbsp;        SessionStorage session = expenseInputData.getSession();</b>
<b class="fc">&nbsp;        MonthlyStorage month = session.getMonthlyData(expenseInputData.getMonthID());</b>
<b class="fc">&nbsp;        ArrayList&lt;Expense&gt; monthExpenseList = month.getExpenseData();</b>
<b class="fc">&nbsp;        ArrayList&lt;Category&gt; categoryList = month.getCategoryData();</b>
&nbsp;        Expense selectedExpense;
&nbsp;
&nbsp;        try {
<b class="fc">&nbsp;            Category selectedCategory = findCategory(categoryList, expenseInputData.getOldCategory());</b>
&nbsp;
<b class="fc">&nbsp;            if(Objects.equals(expenseInputDataEdit.getOldCategory(), &quot;Other&quot;)){</b>
<b class="nc">&nbsp;                selectedExpense = findExpense(recurringExpenseList, expenseInputData.getOldExpense());</b>
<b class="fc">&nbsp;            }else{selectedExpense = findExpense(monthExpenseList, expenseInputData.getOldExpense());}</b>
&nbsp;
<b class="fc">&nbsp;            double valueDouble = toDouble(expenseInputDataEdit.getValue());</b>
<b class="fc">&nbsp;            if (valueDouble &lt; 0) {</b>
&nbsp;                //4. Expense budget less than 0 fail
<b class="fc">&nbsp;                ExpenseOD expenseOutputDataFailEdit = new ExpenseOD(&quot;Expense budget can&#39;t be less than $0. Please try again!&quot;);</b>
<b class="fc">&nbsp;                return expenseOB.fail(expenseOutputDataFailEdit);</b>
&nbsp;            }//&amp;&amp;!expenseInputData.getIsRecurringExpense()
<b class="fc">&nbsp;            if(!Objects.equals(expenseInputDataEdit.getName(), expenseInputDataEdit.getOldExpense())){</b>
<b class="fc">&nbsp;                if(checkHaveSameNameInList(monthExpenseList)) {</b>
&nbsp;                    //1. Repeated name fail
<b class="fc">&nbsp;                    ExpenseOD expenseOutputDataFailEdit = new ExpenseOD(&quot;There is already a expense with this new name in this month.&quot;);</b>
<b class="fc">&nbsp;                    return expenseOB.fail(expenseOutputDataFailEdit);</b>
&nbsp;                }}
<b class="fc">&nbsp;            if (changeInRecurringInfo()) {// 4. Same recurring expense name fail</b>
<b class="nc">&nbsp;                if (expenseInputData.getIsRecurringExpense()) {</b>
<b class="nc">&nbsp;                    if (checkHaveSameNameInList(recurringExpenseList)) {</b>
<b class="nc">&nbsp;                        ExpenseOD expenseOutputDataFailEdit = new ExpenseOD(&quot;There is a recurring expense with this name, you don&#39;t need to add recurring expense in month! &quot; +</b>
&nbsp;                                &quot;(If this is not the same expense, please use another name!)&quot;);
<b class="nc">&nbsp;                        return expenseOB.fail(expenseOutputDataFailEdit);</b>
&nbsp;                    }else {
<b class="nc">&nbsp;                        selectedExpense.setName(expenseInputDataEdit.getName());</b>
<b class="nc">&nbsp;                        expenseInputDataEdit.setValue(valueDouble);</b>
<b class="nc">&nbsp;                        selectedExpense.setValue(valueDouble);</b>
<b class="nc">&nbsp;                        session.deleteRecurExpense(expenseInputData.getName());</b>
<b class="nc">&nbsp;                        selectedExpense.setCategory(selectedCategory);</b>
<b class="nc">&nbsp;                        ExpenseOD expenseOutputDataSuccessEditRecurring = new ExpenseOD(&quot;You have updated all changes of this expense to the category selected in current month!&quot;);</b>
<b class="nc">&nbsp;                        return expenseOB.success(expenseOutputDataSuccessEditRecurring);</b>
&nbsp;                    }
&nbsp;                }else {
<b class="nc">&nbsp;                    selectedExpense.setName(expenseInputDataEdit.getName());</b>
<b class="nc">&nbsp;                    expenseInputDataEdit.setValue(valueDouble);</b>
<b class="nc">&nbsp;                    selectedExpense.setValue(valueDouble);</b>
<b class="nc">&nbsp;                    session.addRecurExpense(selectedExpense);</b>
<b class="nc">&nbsp;                    selectedExpense.setCategory(findCategory(categoryList, &quot;Other&quot;));</b>
<b class="nc">&nbsp;                    ExpenseOD expenseOutputDataSuccessEditRecurring = new ExpenseOD(&quot;You have updated all changes of this expense to a recurring expense in current session!&quot;);</b>
<b class="nc">&nbsp;                    return expenseOB.success(expenseOutputDataSuccessEditRecurring);</b>
&nbsp;                }
&nbsp;                    }
&nbsp;
<b class="fc">&nbsp;            selectedExpense.setName(expenseInputDataEdit.getName());</b>
<b class="fc">&nbsp;            expenseInputDataEdit.setValue(valueDouble);</b>
<b class="fc">&nbsp;            selectedExpense.setValue(valueDouble);</b>
&nbsp;
<b class="fc">&nbsp;            ExpenseOD expenseOutputDataSuccessEdit = new ExpenseOD(&quot;You have edited a expense!&quot;);</b>
<b class="fc">&nbsp;            return expenseOB.success(expenseOutputDataSuccessEdit);</b>
&nbsp;
<b class="fc">&nbsp;            } catch(NoSuchElementException e){</b>
&nbsp;                //2. NoSuchElementException fail
<b class="fc">&nbsp;                ExpenseOD expenseOutputDataFailEdit = new ExpenseOD(&quot;There is no such expense in the current month. Please add a new expense or select existing expense!&quot;);</b>
<b class="fc">&nbsp;                return expenseOB.fail(expenseOutputDataFailEdit);</b>
<b class="fc">&nbsp;            } catch(NumberFormatException|NullPointerException e){</b>
&nbsp;                //3. NumberFormatException|NullPointerException fail
<b class="fc">&nbsp;                ExpenseOD expenseOutputDataFailEdit = new ExpenseOD(&quot;Expense budget needs to be a number. Please try again!&quot;);</b>
<b class="fc">&nbsp;                return expenseOB.fail(expenseOutputDataFailEdit);</b>
&nbsp;            }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @param ExpenseData An ArrayList of expenses.
&nbsp;     * @param name Expense name.
&nbsp;     * @return Expense with given String name
&nbsp;     * @throws NoSuchElementException thrown when couldn&#39;t find Expense with String nane
&nbsp;     */
&nbsp;
&nbsp;        public Expense findExpense(ArrayList&lt;Expense&gt; ExpenseData, String name)throws NoSuchElementException{
<b class="fc">&nbsp;            for (Expense expense : ExpenseData) {</b>
<b class="fc">&nbsp;                if (Objects.equals(expense.getName(), name)) {</b>
<b class="fc">&nbsp;                    return expense;</b>
&nbsp;                }
<b class="fc">&nbsp;            }</b>
<b class="fc">&nbsp;            throw new NoSuchElementException();</b>
&nbsp;        }
&nbsp;
&nbsp;    /**
&nbsp;     * @param monthCategoryData An ArrayList of categories.
&nbsp;     * @param name Category name.
&nbsp;     * @return Category with given String name
&nbsp;     * @throws NoSuchElementException thrown when couldn&#39;t find Expense with String nane
&nbsp;     */
&nbsp;    public Category findCategory (ArrayList &lt; Category &gt; monthCategoryData, String name) throws NoSuchElementException {
<b class="fc">&nbsp;            for (Category category : monthCategoryData) {</b>
<b class="fc">&nbsp;                if (Objects.equals(category.getName(), name)) {</b>
<b class="fc">&nbsp;                    return category;</b>
&nbsp;                }
<b class="fc">&nbsp;            }</b>
<b class="nc">&nbsp;            throw new NoSuchElementException();</b>
&nbsp;        }
&nbsp;
&nbsp;    /**
&nbsp;     * Identifying the only two cases when Session.recurringExpenseData needs to updated when attempting to edit Expense.
&nbsp;     * (The user changes their response for the isRecurringExpense checkbox)
&nbsp;     * @return boolean suggesting there is a need to update Session.recurringExpenseData
&nbsp;     */
&nbsp;    private boolean changeInRecurringInfo() {
<b class="fc">&nbsp;        if(expenseInputData.getIsRecurringExpense()) {</b>
<b class="nc">&nbsp;            try {findExpense(recurringExpenseList, expenseInputData.getName());</b>
<b class="nc">&nbsp;                return false;</b>
<b class="nc">&nbsp;            }catch (NoSuchElementException e){</b>
<b class="nc">&nbsp;                return true;}</b>
&nbsp;        }else{
<b class="fc">&nbsp;            try{findExpense(recurringExpenseList, expenseInputData.getName());</b>
<b class="nc">&nbsp;            return true;</b>
<b class="fc">&nbsp;            }catch(NoSuchElementException e) {</b>
<b class="fc">&nbsp;                return false;}</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Checks if a given Expense arraylist contains a name that is the same as the Expense name input.
&nbsp;     * @param expenseList ArrayList&lt;Expense&gt; containing a list of expenses
&nbsp;     * @return boolean checks if same name exists
&nbsp;     */
&nbsp;    private boolean checkHaveSameNameInList(ArrayList&lt;Expense&gt; expenseList){
<b class="fc">&nbsp;        for (Expense expense1 : expenseList) {</b>
<b class="fc">&nbsp;            return expense1.getName().equals(expenseInputData.getName());</b>
&nbsp;    }
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;}
&nbsp;
&nbsp;
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-08-05 23:09</div>
</div>
</body>
</html>
